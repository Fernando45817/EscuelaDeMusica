<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teclado de Piano Extendido</title>
    
    <style>
     body{
        background-image: url(img/EscuelaDeMusica-main/img/Teatro-Rialto_Sala-Principal.jpg);
        background-position: center;
        background-size: cover; 
        min-height: 100vh;
        margin: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
     }
        /* Controles generales */
        .controls {
            display: flex;
            gap: 30px;
            margin-top: 20px;
            color: white;
            text-align: center;
        }
        .controls h2 {
            margin-bottom: 5px;
            font-size: 1.2em;
        }
        .controls select {
            padding: 5px;
            font-size: 1em;
            border-radius: 5px;
        }

        /* Contenedor principal para todas las octavas */
        .piano-container {
            display: flex;
            justify-content: center;
            padding: 20px;
            background-color: #333;
            border-radius: 10px;
            margin-top: 20px; 
        }

        /* Contenedor de cada octava (C-B) - CLAVE: position: relative */
        .octave {
            display: flex;
            position: relative; 
        }

        /* Estilos generales para todas las teclas */
        .key {
            font-size: 8px;
            display: flex;
            justify-content: center;
            align-items: end;
            padding-bottom: 5px;
            border-end-start-radius: 7px;
            border-end-end-radius: 7px;
            border: 1px solid black;
            box-sizing: border-box;
            transition: background-color 0.1s;
            cursor: pointer;
        }

        /* Estilos para las teclas blancas */
        .white-keys {
            display: flex;
            z-index: 1;
        }

        .white-key {
            height: 110px;
            width: 40px;
            background: whitesmoke;
            margin-right: -1px;
        }

        /* Estilos para las teclas negras */
        .black-keys {
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            z-index: 2;
        }

        .black-key {
            background: black;
            color: white;
            height: 70px;
            width: 30px;
            position: absolute; 
            align-items: center; 
        }
        
        /* Posicionamiento de las teclas negras reutilizable */
        .black-keys .black-key:nth-child(1) { left: 25px; } /* DO# */
        .black-keys .black-key:nth-child(2) { left: 65px; } /* RE# */
        .black-keys .black-key:nth-child(3) { left: 145px; } /* FA# */
        .black-keys .black-key:nth-child(4) { left: 185px; } /* SOL# */
        .black-keys .black-key:nth-child(5) { left: 225px; } /* LA# */

        /* Efectos de interacci贸n (AADIDOS para el teclado de PC) */
        .white-key:hover { background-color: orangered; }
        .black-key:hover { background-color: brown; }
        
        .white-key:active,
        .white-key.playing { 
            background-color: red !important; 
        }
        .black-key:active,
        .black-key.playing { 
            background-color: maroon !important; 
        }
    </style>
</head>
<body>
    
    <div class="controls">
        <div>
            <h2>Elige el Tipo de Onda (Timbre)</h2>
            <select id="waveformSelector">
                <option value="piano" selected>Piano Simulado</option>
                <option value="sine">Sinusoidal (Suave)</option>
                <option value="square">Cuadrada (Synth)</option>
                <option value="sawtooth">Diente de Sierra (Agresivo)</option>
                <option value="triangle">Triangular (Flauta/Melod铆a)</option>
            </select>
        </div>
        <div>
            <h2>Transposici贸n de Octava</h2>
            <select id="octaveShift">
                <option value="0" selected>0 Octavas (Est谩ndar)</option>
                <option value="1">1 Octava Arriba</option>
                <option value="2">2 Octavas Arriba</option>
                <option value="-1">1 Octava Abajo</option>
            </select>
        </div>
    </div>

    <div class="piano-container">
        
        <div class="octave">
            <div class="white-keys">
                <button class="key white-key" data-note="DO1">DO1</button>
                <button class="key white-key" data-note="RE1">RE1</button>
                <button class="key white-key" data-note="MI1">MI1</button>
                <button class="key white-key" data-note="FA1">FA1</button>
                <button class="key white-key" data-note="SOL1">SOL1</button>
                <button class="key white-key" data-note="LA1">LA1</button>
                <button class="key white-key" data-note="SI1">SI1</button>
            </div>
            <div class="black-keys">
                <button class="key black-key" data-note="DO#1">DO#1</button>
                <button class="key black-key" data-note="RE#1">RE#1</button>
                <button class="key black-key" data-note="FA#1">FA#1</button>
                <button class="key black-key" data-note="SOL#1">SOL#1</button>
                <button class="key black-key" data-note="LA#1">LA#1</button>
            </div>
        </div>

        <div class="octave">
            <div class="white-keys">
                <button class="key white-key" data-note="DO2">DO2</button>
                <button class="key white-key" data-note="RE2">RE2</button>
                <button class="key white-key" data-note="MI2">MI2</button>
                <button class="key white-key" data-note="FA2">FA2</button>
                <button class="key white-key" data-note="SOL2">SOL2</button>
                <button class="key white-key" data-note="LA2">LA2</button>
                <button class="key white-key" data-note="SI2">SI2</button>
            </div>
            <div class="black-keys">
                <button class="key black-key" data-note="DO#2">DO#2</button>
                <button class="key black-key" data-note="RE#2">RE#2</button>
                <button class="key black-key" data-note="FA#2">FA#2</button>
                <button class="key black-key" data-note="SOL#2">SOL#2</button>
                <button class="key black-key" data-note="LA#2">LA#2</button>
            </div>
        </div>

        <div class="octave">
            <div class="white-keys">
                <button class="key white-key" data-note="DO3">DO3</button>
                <button class="key white-key" data-note="RE3">RE3</button>
                <button class="key white-key" data-note="MI3">MI3</button>
                <button class="key white-key" data-note="FA3">FA3</button>
            </div>
            <div class="black-keys">
                <button class="key black-key" data-note="DO#3">DO#3</button>
                <button class="key black-key" data-note="RE#3">RE#3</button>
            </div>
        </div>

    </div>
    <a href="index.html"><img src="../EscuelaDeMusica/img/EscuelaDeMusica-main/img/regresa-naranja.png" width="100" height="100"></a>

<script>
    // ---------------------------------------------------
    // 1. INICIALIZACIN Y DEFINICIN DE SONIDO
    // ---------------------------------------------------
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();

    // Obtener los selectores del DOM
    const waveformSelector = document.getElementById('waveformSelector');
    const octaveShiftSelector = document.getElementById('octaveShift');

    //  DEFINICIN DE ONDA PERIDICA PARA PIANO SIMULADO 
    const numHarmonics = 12;
    const real = new Float32Array(numHarmonics);
    const imag = new Float32Array(numHarmonics);

    // Amplitudes de los arm贸nicos para un timbre m谩s rico (similar a un clavinete/piano)
    real[1] = 1; real[2] = 0.5; real[3] = 0.3; real[4] = 0.25; real[5] = 0.15; real[6] = 0.1;

    const pianoWave = audioCtx.createPeriodicWave(real, imag);

    // Mapeo de Frecuencias (Notas de DO1 a FA3)
    const noteFrequencies = {
        'DO1': 65.41, 'DO#1': 69.30, 'RE1': 73.42, 'RE#1': 77.78, 'MI1': 82.41,
        'FA1': 87.31, 'FA#1': 92.50, 'SOL1': 98.00, 'SOL#1': 103.83, 'LA1': 110.00,
        'LA#1': 116.54, 'SI1': 123.47,
        
        'DO2': 130.81, 'DO#2': 138.59, 'RE2': 146.83, 'RE#2': 155.56, 'MI2': 164.81,
        'FA2': 174.61, 'FA#2': 185.00, 'SOL2': 196.00, 'SOL#2': 207.65, 'LA2': 220.00,
        'LA#2': 233.08, 'SI2': 246.94,
        
        'DO3': 261.63, 'DO#3': 277.18, 'RE3': 293.66, 'RE#3': 311.13, 'MI3': 329.63,
        'FA3': 349.23,
    };
    
    //  MAPEO DE TECLAS COMPLETO (26 NOTAS) 
    const keyToNoteMap = {
        // -----------------------------------------------------
        // Octava 1 (DO1 a SI1) - Fila ASDFG... (12 Teclas)
        // -----------------------------------------------------
        'a': 'DO1',   '1': 'DO#1', 
        's': 'RE1',   '2': 'RE#1', 
        'd': 'MI1',   
        
        'f': 'FA1',   '4': 'FA#1', 
        'g': 'SOL1',  '5': 'SOL#1', 
        'h': 'LA1',   '6': 'LA#1', 
        'j': 'SI1',
        
        // -----------------------------------------------------
        // Octava 2 (DO2 a SI2) - Fila QWERTY... (12 Teclas)
        // -----------------------------------------------------
        'q': 'DO2',   '7': 'DO#2', 
        'w': 'RE2',   '8': 'RE#2', 
        'e': 'MI2', 
        
        'r': 'FA2',   '9': 'FA#2', 
        't': 'SOL2',  '0': 'SOL#2', 
        'y': 'LA2',   '-': 'LA#2', 
        'u': 'SI2',
        
        // -----------------------------------------------------
        // Octava 3 (DO3 a FA3) - Teclas restantes (4 Teclas)
        // -----------------------------------------------------
        'i': 'DO3',   'o': 'DO#3', 
        'p': 'RE3',   '帽': 'RE#3', 
        ';': 'MI3',   
        'k': 'FA3'    
    };

    const activeOscillators = {}; 

    // ---------------------------------------------------
    // 2. FUNCIONES DE SONIDO
    // ---------------------------------------------------
    function playNote(noteName) {
        if (activeOscillators[noteName]) {
            stopNote(noteName);
        }

        let freq = noteFrequencies[noteName];
        if (!freq) return; 

        // L贸gica de Transposici贸n de Octava 
        const shiftValue = parseInt(octaveShiftSelector.value);
        freq = freq * Math.pow(2, shiftValue);

        //  Generaci贸n de Audio
        const selectedWaveform = waveformSelector.value;
        const oscillator = audioCtx.createOscillator();
        
        // Aplica la onda peri贸dica (piano) o la onda simple seleccionada
        if (selectedWaveform === 'piano') {
            oscillator.setPeriodicWave(pianoWave);
        } else {
            oscillator.type = selectedWaveform; 
        }
        
        oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime); 

        const gainNode = audioCtx.createGain();
        gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime); 
        
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        oscillator.start();

        // Aplica "decay" (desvanecimiento) para simular el apagado de la nota
        gainNode.gain.exponentialRampToValueAtTime(
            0.0001, 
            audioCtx.currentTime + 1.0 
        );

        oscillator.stop(audioCtx.currentTime + 1.0);

        activeOscillators[noteName] = oscillator;
        
        oscillator.onended = () => {
            delete activeOscillators[noteName];
        };
    }
    
    function stopNote(noteName) {
        if (activeOscillators[noteName]) {
            activeOscillators[noteName].stop(audioCtx.currentTime + 0.05); 
            delete activeOscillators[noteName];
        }
    }

    // Funci贸n auxiliar para obtener el elemento de la tecla
    function getKeyElement(noteName) {
        return document.querySelector(`.key[data-note="${noteName}"]`);
    }

    // ---------------------------------------------------
    // 3. EVENTOS DE INTERACCIN (MOUSE Y TECLADO PC)
    // ---------------------------------------------------
    
    // Eventos de MOUSE / TOUCH
    document.querySelectorAll('.key').forEach(key => {
        const noteName = key.getAttribute('data-note'); 
        
        key.addEventListener('mousedown', (e) => {
            e.preventDefault();
            if (audioCtx.state === 'suspended') { audioCtx.resume(); } // Asegura que el audio inicie
            playNote(noteName);
            key.classList.add('playing');
        });
        
        key.addEventListener('mouseup', () => { key.classList.remove('playing'); });
        key.addEventListener('mouseleave', () => { key.classList.remove('playing'); });

        key.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (audioCtx.state === 'suspended') { audioCtx.resume(); }
            playNote(noteName);
            key.classList.add('playing');
        }, { passive: false });

        key.addEventListener('touchend', (e) => {
            e.preventDefault();
            key.classList.remove('playing');
        });
    });

    // Eventos de TECLADO DE COMPUTADORA
    const keysPressed = {}; 

    document.addEventListener('keydown', (e) => {
        const key = e.key.toLowerCase();
        const noteName = keyToNoteMap[key];
        
        if (noteName && !keysPressed[key]) {
            e.preventDefault();
            
            if (audioCtx.state === 'suspended') { audioCtx.resume(); }
            playNote(noteName);
            keysPressed[key] = true;

            const keyElement = getKeyElement(noteName);
            if (keyElement) {
                keyElement.classList.add('playing');
            }
        }
    });

    document.addEventListener('keyup', (e) => {
        const key = e.key.toLowerCase();
        const noteName = keyToNoteMap[key];
        
        if (noteName && keysPressed[key]) {
            e.preventDefault();
            keysPressed[key] = false;
            
            const keyElement = getKeyElement(noteName);
            if (keyElement) {
                keyElement.classList.remove('playing');
            }
        }
    });

</script>
 </body>
</html>