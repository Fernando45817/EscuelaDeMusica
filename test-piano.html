<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé∂ Academia de M√∫sica Sonata | Escuela y Tienda</title>
    <style>
        /* --- VARIABLES DE DISE√ëO MEJORADAS --- */
        :root {
            --dark-blue-shadow: rgba(6, 10, 77, 0.7);
            --grey-table-bg: #2b2b2b; /* Gris m√°s oscuro para fondo */
            --table-border-color: #1a1a1a;
            --text-color: #f5f5f5;
            --heading-color: white;
            --white-bg-opacity: rgba(255, 255, 255, 0.9);
            --key-label-color: #6d6d6d;
            --accent-color: #388e3c; /* Verde principal */
        }

        /* --- ESTILOS GENERALES --- */
        body {
            background-image:url(img/fondo4.jpg);
            background-attachment: fixed; /* Mantiene el fondo fijo al hacer scroll */
            background-size: cover;
            margin: 0;
            padding: 0 10px 50px 10px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-color);
        }

        /* --- T√çTULOS MEJORADOS --- */
        h1, h2 {
            text-align: center;
            font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
            color: var(--heading-color);
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.9);
            margin: 40px 0 20px 0;
            letter-spacing: 2px;
            border-bottom: 3px solid var(--accent-color); /* L√≠nea de acento */
            padding-bottom: 10px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        h1 { font-size: 3em; }

        /* --- IM√ÅGENES (General) y HOVER --- */
        img {
            box-shadow: 0 6px 15px 5px var(--dark-blue-shadow);
            border-radius: 8px;
            object-fit: cover;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            max-width: 100%;
            height: auto;
        }

        img:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 20px 8px rgba(56, 142, 60, 0.8); /* Sombra con acento */
        }

        /* Logo principal */
        .header-logo {
            display: block;
            margin: 30px auto 0 auto;
            max-width: 350px;
            height: auto;
            border-radius: 50%; /* Si el logo es circular */
        }

        /* --- SECCI√ìN SOBRE NOSOTROS --- */
        .about-section { 
            text-align: center;
            list-style: none;
            padding: 25px;
            margin: 20px auto;
            max-width: 850px;
            background-color: var(--white-bg-opacity);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            font-size: 1.2em;
            line-height: 1.6;
            color: #333;
        }

        /* --- SEPARADOR (HR) --- */
        hr {
            border: none;
            height: 4px;
            background-color: var(--accent-color); /* Usando color de acento */
            margin: 50px auto;
            max-width: 90%;
            border-radius: 2px;
        }

        /* --- TABLAS (INSTALACIONES y CLASES) --- */
        table {
            margin: 50px auto;
            padding: 15px;
            border: 10px solid var(--accent-color); /* Borde acentuado */
            text-align: center;
            font-family: 'Impact', sans-serif;
            font-size: 20px;
            border-collapse: separate; 
            border-spacing: 0;
            background-color: var(--grey-table-bg);
            border-radius: 15px;
            overflow: hidden; 
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.7);
            width: 95%; 
            max-width: 1300px;
        }

        th, td {
            border: 1px solid var(--table-border-color); /* Borde m√°s fino entre celdas */
            padding: 12px 8px;
            color: var(--heading-color);
            vertical-align: middle;
            background-color: var(--grey-table-bg);
        }

        th {
            background-color: rgba(0, 0, 0, 0.4); /* Fondo para encabezados */
            font-size: 1.1em;
            padding: 15px 8px;
            font-weight: normal;
        }
        
        /* Contenedor de imagen en tabla para uniformidad */
        .table-img-container {
            width: 100%;
            max-width: 250px; /* Tama√±o uniforme */
            margin: 0 auto;
            display: block;
        }
        .table-img-container img {
            width: 100%;
            height: auto;
            aspect-ratio: 16/9; /* Im√°genes uniformemente rectangulares */
            object-fit: cover;
            max-height: 200px; /* Limita la altura de las im√°genes */
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.5);
        }
        /* Ajuste para la imagen de Tololoche si es vertical */
        .tololoche-img-container {
             aspect-ratio: 9/16; /* Vertical para el tololoche */
        }
        .tololoche-img-container img {
             aspect-ratio: 9/16;
             max-height: 250px;
        }
        

        /* --- SECCI√ìN INSTRUMENTOS --- */
        #ContenedorPadre {
            text-align: center;
            margin: 30px auto;
            padding: 50px 20px;
            background-color: rgba(255, 255, 255, 0.15);
            max-width: 800px;
            border-radius: 15px;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.4);
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
            font-size: 1.2em;
        }
        #screen1::before {
            content: "¬°Estamos preparando nuestro cat√°logo de instrumentos!";
        }
        
        /* Bot√≥n de compra de instrumentos */
        .BuyInst { margin-top: 10px; }
        .BuyButton {
            display: inline-block;
            color: white; 
            padding: 15px 30px; 
            background-color: var(--accent-color); 
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.8);
            transition: background-color 0.3s;
        }
        .BuyButton:hover { background-color: #2e7d32; }

        /* --- ENLACES INTERMEDIOS (TIENDA/PIANO) --- */
        .intermediate-links {
            display: flex;
            justify-content: center;
            gap: 50px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        .intermediate-links img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
        }

        /* --- ENLACES Y FOOTER --- */
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 50px 0;
            flex-wrap: wrap;
            text-align: center;
        }
        .footer-link-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--heading-color);
            font-weight: bold;
            font-size: 1em;
        }
        .footer-links img {
            width: 70px; /* M√°s peque√±os */
            height: 70px;
            border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            margin-bottom: 5px;
        }
        .footer-links p { margin: 0; }

        /* --- BOT√ìN DE INSCRIPCI√ìN --- */
        .inscription-container {
            text-align: center;
            margin-bottom: 50px;
        }
        .inscription-button {
            display: inline-block;
            background-color: var(--dark-blue-shadow);
            color: white;
            padding: 20px 45px;
            text-decoration: none;
            border-radius: 30px;
            font-size: 1.8em;
            font-weight: bold;
            letter-spacing: 1px;
            transition: background-color 0.3s, transform 0.3s;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.8);
            border: 2px solid var(--accent-color); /* Borde acentuado */
        }

        .inscription-button:hover {
            background-color: #040733;
            transform: scale(1.05);
        }

        /* ------------------------------------- */
        /* --- ESTILOS DEL PIANO VIRTUAL --- */
        /* ... (Dejo el piano sin cambios para no romper la funcionalidad JS) ... */
        /* ------------------------------------- */

        /* ------------------------------------- */
        /* --- RESPONSIVIDAD AVANZADA (M√ìVIL) --- */
        /* ------------------------------------- */
        @media (max-width: 768px) {
            h1 { font-size: 2.2em; }
            h2 { font-size: 1.8em; }
            
            /* Contenedor principal de tablas en m√≥vil */
            table {
                display: block;
                border: 5px solid var(--accent-color); /* Borde m√°s simple en m√≥vil */
            }

            /* Ocultar encabezados de clases en m√≥vil */
            .classes-table thead {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }

            .classes-table tr, .facilities-table tr {
                margin-bottom: 10px;
                border: 1px solid var(--table-border-color);
                border-radius: 8px;
                overflow: hidden;
                display: flex;
                flex-wrap: wrap;
            }

            /* CLASES DE M√öSICA */
            .classes-table td {
                display: flex;
                flex-direction: column;
                align-items: center;
                width: 50%; /* Dos por fila visualmente */
                border: none;
                padding: 10px;
                box-sizing: border-box;
                font-size: 0.9em;
                text-align: center;
            }
            .classes-table td .table-img-container {
                max-width: 100%;
            }
            .classes-table td .table-img-container img {
                height: 100px; /* Reducci√≥n de altura en m√≥vil */
                aspect-ratio: 16/9;
                border-radius: 5px;
            }
            .classes-table td:before { /* Etiqueta de la clase */
                content: attr(data-label);
                font-weight: bold;
                color: var(--accent-color);
                margin-bottom: 5px;
                display: block;
            }
            .classes-table tr {
                justify-content: center;
                gap: 10px;
            }

            /* INSTALACIONES */
            .facilities-table tr {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 5px;
                padding: 5px;
            }
            .facilities-table td {
                display: block;
                width: 100%;
                border: none;
                padding: 0;
            }
            .facilities-table td img {
                height: 150px;
                aspect-ratio: 16/9;
            }

            /* Ajustes de piano para m√≥vil (ya estaban bien) */
            .key::after { content: none; }
            .piano-container {
                overflow-x: auto;
                justify-content: flex-start;
                max-width: 100%;
            }
        }
    </style>
</head>
<body>

    <img src="img/logo mejorado 2 sonata.png" alt="Logo de Sonata" class="header-logo">

    <h1>Prueba tu talento üéπ</h1>

    <div class="piano-controls">
        <div>
            <h2>Elige el Tipo de Onda (Timbre)</h2>
            <select id="waveformSelector">
                <option value="piano" selected>Piano Simulado</option>
                <option value="sine">Sinusoidal (Suave)</option>
                <option value="square">Cuadrada (Synth)</option>
                <option value="sawtooth">Diente de Sierra (Agresivo)</option>
                <option value="triangle">Triangular (Flauta/Melod√≠a)</option>
            </select>
        </div>
        <div>
            <h2>Transposici√≥n de Octava</h2>
            <select id="octaveShift">
                <option value="0" selected>0 Octavas (Est√°ndar)</option>
                <option value="1">1 Octava Arriba</option>
                <option value="2">2 Octavas Arriba</option>
                <option value="-1">1 Octava Abajo</option>
            </select>
        </div>
    </div>

    <div class="piano-container">
        <div class="octave">
            <div class="white-keys">
                <button class="key white-key" data-note="DO1" data-key-label="A">DO1</button>
                <button class="key white-key" data-note="RE1" data-key-label="S">RE1</button>
                <button class="key white-key" data-note="MI1" data-key-label="D">MI1</button>
                <button class="key white-key" data-note="FA1" data-key-label="F">FA1</button>
                <button class="key white-key" data-note="SOL1" data-key-label="G">SOL1</button>
                <button class="key white-key" data-note="LA1" data-key-label="H">LA1</button>
                <button class="key white-key" data-note="SI1" data-key-label="J">SI1</button>
            </div>
            <div class="black-keys">
                <button class="key black-key" data-note="DO#1" data-key-label="1">DO#1</button>
                <button class="key black-key" data-note="RE#1" data-key-label="2">RE#1</button>
                <button class="key black-key" data-note="FA#1" data-key-label="4">FA#1</button>
                <button class="key black-key" data-note="SOL#1" data-key-label="5">SOL#1</button>
                <button class="key black-key" data-note="LA#1" data-key-label="6">LA#1</button>
            </div>
        </div>

        <div class="octave">
            <div class="white-keys">
                <button class="key white-key" data-note="DO2" data-key-label="Q">DO2</button>
                <button class="key white-key" data-note="RE2" data-key-label="W">RE2</button>
                <button class="key white-key" data-note="MI2" data-key-label="E">MI2</button>
                <button class="key white-key" data-note="FA2" data-key-label="R">FA2</button>
                <button class="key white-key" data-note="SOL2" data-key-label="T">SOL2</button>
                <button class="key white-key" data-note="LA2" data-key-label="Y">LA2</button>
                <button class="key white-key" data-note="SI2" data-key-label="U">SI2</button>
            </div>
            <div class="black-keys">
                <button class="key black-key" data-note="DO#2" data-key-label="7">DO#2</button>
                <button class="key black-key" data-note="RE#2" data-key-label="8">RE#2</button>
                <button class="key black-key" data-note="FA#2" data-key-label="9">FA#2</button>
                <button class="key black-key" data-note="SOL#2" data-key-label="0">SOL#2</button>
                <button class="key black-key" data-note="LA#2" data-key-label="-">LA#2</button>
            </div>
        </div>

        <div class="octave">
            <div class="white-keys">
                <button class="key white-key" data-note="DO3" data-key-label="I">DO3</button>
                <button class="key white-key" data-note="RE3" data-key-label="P">RE3</button>
                <button class="key white-key" data-note="MI3" data-key-label=";">MI3</button>
                <button class="key white-key" data-note="FA3" data-key-label="K">FA3</button>
            </div>
            <div class="black-keys">
                <button class="key black-key" data-note="DO#3" data-key-label="O">DO#3</button>
                <button class="key black-key" data-note="RE#3" data-key-label="√ë">RE#3</button>
            </div>
        </div>
    </div>

    <hr>

    <h1>SOBRE NOSOTROS üè´</h1>

    <ol class="about-section">
        Somos una comunidad que ense√±a a varias personas a tocar varios instrumentos en nuestras instalaciones, como las que se muestran a continuaci√≥n. Nuestro objetivo es cultivar el talento musical en un ambiente profesional y acogedor.
    </ol>

    <hr>

    <h1>NUESTRAS INSTALACIONES ‚ú®</h1>

    <table border="0" class="facilities-table">
        <tbody>
            <tr>
                <td>
                    <div class="table-img-container">
                        <img src="img/tienda.jpg" alt="Vista de la tienda">
                    </div>
                </td>
                <td>
                    <div class="table-img-container">
                        <img src="img/arriba.jpg" alt="Zona de espera">
                    </div>
                </td>
                <td>
                    <div class="table-img-container">
                        <img src="img/arriba1.jpg" alt="Pasillo de instrumentos">
                    </div>
                </td>
                <td>
                    <div class="table-img-container">
                        <img src="img/arriba2.jpg" alt="Sal√≥n de clases">
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="table-img-container">
                        <img src="img/salon1.jpg" alt="Sal√≥n de ensayo 1">
                    </div>
                </td>
                <td>
                    <div class="table-img-container">
                        <img src="img/salon2.jpg" alt="Sal√≥n de ensayo 2">
                    </div>
                </td>
                <td>
                    <div class="table-img-container">
                        <img src="img/salom3.jpg" alt="Sal√≥n de ensayo 3">
                    </div>
                </td>
                <td>
                    <div class="table-img-container">
                        <img src="img/foto de evenrt.jpg" alt="Foto de evento">
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
      
    <hr>

    <h1>CLASES DE M√öSICA üé∏</h1>
    <table border="0" class="classes-table">
        <thead>
            <tr>
                <th>Guitarra / El√©ctrica</th>
                <th>Bajo / El√©ctrico / Ac√∫stico</th>
                <th>Ukulele</th>
                <th>Bandolina</th>
                <th>Viol√≠n</th>
                <th>Tololoche</th>
                <th>Teclado</th>
                <th>Bater√≠as Ac√∫sticas / El√©ctricas</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td data-label="Guitarra / El√©ctrica">
                    <div class="table-img-container">
                        <img src="img/guitarras.jpg" alt="Guitarras">
                    </div>
                </td>
                <td data-label="Bajo / El√©ctrico / Ac√∫stico">
                    <div class="table-img-container">
                        <img src="img/bajos electricos.jpg" alt="Bajos">
                    </div>
                </td>
                <td data-label="Ukulele">
                    <div class="table-img-container">
                        <img src="img/ukulele.jpg" alt="Ukulele">
                    </div>
                </td>
                <td data-label="Bandolina">
                    <div class="table-img-container">
                        <img src="img/mandolina.webp" alt="Bandolina">
                    </div>
                </td>
                <td data-label="Viol√≠n">
                    <div class="table-img-container">
                        <img src="img/Violin.jpg" alt="Viol√≠n">
                    </div>
                </td>
                <td data-label="Tololoche">
                    <div class="table-img-container tololoche-img-container">
                        <img src="img/tololoche-imagen-mejorada.png" alt="Tololoche">
                    </div>
                </td>
                <td data-label="Teclado">
                    <div class="table-img-container">
                        <img src="img/teclado.jpg" alt="Teclado">
                    </div>
                </td>
                <td data-label="Bater√≠as Ac√∫sticas / El√©ctricas">
                    <div class="table-img-container">
                        <img src="img/bateria.jpg" alt="Bater√≠as">
                    </div>
                </td>
            </tr>
        </tbody>
    </table> 
    
    <div style="text-align: center; margin-bottom: 30px;">
         <iframe src="https://www.facebook.com/plugins/video.php?height=314&href=https%3A%2F%2Fwww.facebook.com%2Freel%2F1507419387150097%2F&show_text=false&width=560&t=0" width="560" height="314" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowfullscreen="true" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share" allowFullScreen="true"></iframe>
    </div>

    <div class="intermediate-links">
        <a href="tienda-de-musica.html" target="_blank" class="footer-link-item">
            <img src="img/logo bolsa.webp" alt="Tienda de M√∫sica">
            <p>Visita Nuestra Tienda</p>
        </a>
        <a href="piano.html" class="footer-link-item">
            <img src="../EscuelaDeMusica/img/piano_PNG10893.png" alt="Clases de Piano">
            <p>Ir al Piano Virtual</p>
        </a>
    </div>

    <hr>

    <h1>INSTRUMENTOS (Pr√≥ximamente) üõçÔ∏è</h1>

    <div id="ContenedorPadre" class="block">
        <div id="screen1">
        </div>
        <div class="BuyInst">
            <p>Comprar instrumentos:</p>
            <a href="BuyInstruments.html" class="BuyButton">COMPRAR INSTRUMENTOS</a>
        </div>
    </div>

    <hr>

    <h1>INSCRIPCIONES ¬°√önete a la M√∫sica! üéµ</h1>

    <div class="inscription-container">
        <a href="formularios.html" class="inscription-button">Click para Inscribirse Ahora</a>
    </div>

    <footer>
        <div class="footer-links">
            <a href="https://maps.app.goo.gl/K9K94wTeLVVHmqof6" target="_blank" class="footer-link-item">
                <img src="img/mapa.png" alt="Mapa de ubicaci√≥n">
                <p>Ubicaci√≥n</p>
            </a>
            <a href="piano.html" class="footer-link-item">
                <img src="../EscuelaDeMusica/img/piano_PNG10893.png" alt="Clases de Piano">
                <p>Piano Virtual</p>
            </a>
            <a href="https://www.instagram.com/sonata_vivoperlei/" target="_blank" class="footer-link-item">
                <img src="instagram-icon-logo-symbol-free-png.webp" alt="Instagram">
                <p>Instagram</p>
            </a>
            <a href="https://www.facebook.com/search/top?q=academia%20y%20tienda%20de%20m%C3%BAsica%20%22sonata%22" target="_blank" class="footer-link-item">
                <img src="facebook-logo-clipart-vector-8.png" alt="Facebook">
                <p>Facebook</p>
            </a>
        </div>
    </footer>

    <script>
        // *** El JavaScript original para el piano se mantiene intacto aqu√≠ ***
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        // Obtener los selectores del DOM
        const waveformSelector = document.getElementById('waveformSelector');
        const octaveShiftSelector = document.getElementById('octaveShift');

        const numHarmonics = 12;
        const real = new Float32Array(numHarmonics);
        const imag = new Float32Array(numHarmonics);

        // Amplitudes de los arm√≥nicos para un timbre m√°s rico (similar a un clavinete/piano)
        real[1] = 1; real[2] = 0.5; real[3] = 0.3; real[4] = 0.25; real[5] = 0.15; real[6] = 0.1;

        const pianoWave = audioCtx.createPeriodicWave(real, imag);

        // Mapeo de Frecuencias (Notas de DO1 a FA3)
        const noteFrequencies = {
            'DO1': 65.41, 'DO#1': 69.30, 'RE1': 73.42, 'RE#1': 77.78, 'MI1': 82.41,
            'FA1': 87.31, 'FA#1': 92.50, 'SOL1': 98.00, 'SOL#1': 103.83, 'LA1': 110.00,
            'LA#1': 116.54, 'SI1': 123.47,
            
            'DO2': 130.81, 'DO#2': 138.59, 'RE2': 146.83, 'RE#2': 155.56, 'MI2': 164.81,
            'FA2': 174.61, 'FA#2': 185.00, 'SOL2': 196.00, 'SOL#2': 207.65, 'LA2': 220.00,
            'LA#2': 233.08, 'SI2': 246.94,
            
            'DO3': 261.63, 'DO#3': 277.18, 'RE3': 293.66, 'RE#3': 311.13, 'MI3': 329.63,
            'FA3': 349.23,
        };
        
        // üîë MAPEO DE TECLAS COMPLETO (26 NOTAS) üîë
        const keyToNoteMap = {
            // Octava 1 (DO1 a SI1) - Fila ASDFG... (12 Teclas)
            'a': 'DO1',   '1': 'DO#1', 
            's': 'RE1',   '2': 'RE#1', 
            'd': 'MI1',   
            
            'f': 'FA1',   '4': 'FA#1', 
            'g': 'SOL1',  '5': 'SOL#1', 
            'h': 'LA1',   '6': 'LA#1', 
            'j': 'SI1',
            
            
            'q': 'DO2',   '7': 'DO#2', 
            'w': 'RE2',   '8': 'RE#2', 
            'e': 'MI2', 
            
            'r': 'FA2',   '9': 'FA#2', 
            't': 'SOL2',  '0': 'SOL#2', 
            'y': 'LA2',   '-': 'LA#2', 
            'u': 'SI2',
            
            
            'i': 'DO3',   'o': 'DO#3', 
            'p': 'RE3',   '√±': 'RE#3', 
            ';': 'MI3',   
            'k': 'FA3'    
        };

        const activeOscillators = {}; 

        function playNote(noteName) {
            // Comprobaci√≥n para evitar sonar si ya est√° sonando, √∫til para prevenir errores
            if (activeOscillators[noteName]) {
                return;
            }

            let freq = noteFrequencies[noteName];
            if (!freq) return; 

            // Aplicar transposici√≥n de octava
            const shiftValue = parseInt(octaveShiftSelector.value);
            freq = freq * Math.pow(2, shiftValue);

            // Configurar el oscilador
            const selectedWaveform = waveformSelector.value;
            const oscillator = audioCtx.createOscillator();
            
            if (selectedWaveform === 'piano') {
                oscillator.setPeriodicWave(pianoWave);
            } else {
                oscillator.type = selectedWaveform; 
            }
            
            oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime); 

            // Configurar el Gain Node (Volumen y ADSR simple)
            const gainNode = audioCtx.createGain();
            gainNode.gain.setValueAtTime(0, audioCtx.currentTime); // Inicia en 0 para evitar click
            
            // Ataque r√°pido
            gainNode.gain.linearRampToValueAtTime(0.6, audioCtx.currentTime + 0.02);
            
            // Decay/Sustain
            gainNode.gain.linearRampToValueAtTime(0.4, audioCtx.currentTime + 0.1);


            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            oscillator.start();

            activeOscillators[noteName] = { oscillator, gainNode };
        }
        
        function stopNote(noteName) {
            if (activeOscillators[noteName]) {
                const { oscillator, gainNode } = activeOscillators[noteName];

                // Release (Liberaci√≥n)
                gainNode.gain.cancelScheduledValues(audioCtx.currentTime);
                gainNode.gain.setValueAtTime(gainNode.gain.value, audioCtx.currentTime); 
                gainNode.gain.linearRampToValueAtTime(0.0001, audioCtx.currentTime + 0.5); // 0.5s de release
                
                // Detener el oscilador despu√©s del release
                oscillator.stop(audioCtx.currentTime + 0.5);

                delete activeOscillators[noteName];
            }
        }


        function getKeyElement(noteName) {
            return document.querySelector(`.key[data-note="${noteName}"]`);
        }

        // ------------------------------------
        // Manejo de eventos del rat√≥n/touch
        // ------------------------------------
        document.querySelectorAll('.key').forEach(key => {
            const noteName = key.getAttribute('data-note'); 
            
            // Mouse Down / Touch Start (Reproducir)
            key.addEventListener('mousedown', (e) => {
                e.preventDefault();
                if (audioCtx.state === 'suspended') { audioCtx.resume(); } 
                playNote(noteName);
                key.classList.add('playing');
            });
            key.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (audioCtx.state === 'suspended') { audioCtx.resume(); }
                playNote(noteName);
                key.classList.add('playing');
            }, { passive: false });

            // Mouse Up / Touch End (Detener)
            key.addEventListener('mouseup', () => { 
                stopNote(noteName);
                key.classList.remove('playing'); 
            });
            key.addEventListener('mouseleave', () => { 
                stopNote(noteName);
                key.classList.remove('playing'); 
            });
            key.addEventListener('touchend', (e) => {
                e.preventDefault();
                stopNote(noteName);
                key.classList.remove('playing');
            }, { passive: false });
        });

        // ------------------------------------
        // Manejo de eventos del teclado (PC)
        // ------------------------------------
        const keysPressed = {}; 

        document.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();
            const noteName = keyToNoteMap[key];
            
            if (noteName && !keysPressed[key]) {
                e.preventDefault();
                
                if (audioCtx.state === 'suspended') { audioCtx.resume(); }
                playNote(noteName);
                keysPressed[key] = true;

                const keyElement = getKeyElement(noteName);
                if (keyElement) {
                    keyElement.classList.add('playing');
                }
            }
        });

        document.addEventListener('keyup', (e) => {
            const key = e.key.toLowerCase();
            const noteName = keyToNoteMap[key];
            
            if (noteName && keysPressed[key]) {
                stopNote(noteName);
                delete keysPressed[key];

                const keyElement = getKeyElement(noteName);
                if (keyElement) {
                    keyElement.classList.remove('playing');
                }
            }
        });
    </script>
</body>
</html>